trigger:
  - master

pr:
  - master

jobs:
  - job: "Test"
    pool:
      vmImage: "ubuntu-latest"
    container: tensorflow/tensorflow:custom-op-ubuntu16
    steps:
      - script: pip3 install tensorflow==1.14.0 pytest --user
        displayName: "Install Dependencies"

      - script: make compute_engine_pip_pkg
        displayName: "Build PIP Package"

      - script: pip3 install artifacts/*.whl --user
        displayName: "Install PIP Package"

      - script: python3 -m pytest .
        displayName: "Run unit tests"

  - job: "Lint"
    pool:
      vmImage: "ubuntu-latest"
    steps:
      - task: UsePythonVersion@0
        inputs:
          versionSpec: "3.7"
          architecture: "x64"

      - script: pip install pyflakes==2.1.1 black==19.3b0
        displayName: "Install linting dependencies"

      - script: pyflakes larq_compute_engine
        displayName: "pyflakes"

      - script: black larq_compute_engine --check --target-version py36
        displayName: "Black code style"
